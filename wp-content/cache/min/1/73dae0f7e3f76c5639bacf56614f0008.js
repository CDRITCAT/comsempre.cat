$("#menu-item-317 a").removeAttr("href");$("#menu-item-317").on("click",function(){$('#myModal2').modal('show');});$('.typeahead').bind('typeahead:select',function(ev,suggestion){console.log(suggestion);console.log(suggestion.alcalde);console.log(suggestion.estat);$(".nomdelmunicipi").html(suggestion.nom);$(".nomcomarca").html(suggestion.comarca);$(".nomalcalde").html(suggestion.alcalde);$(".resultatestat").addClass(suggestion.estat);$(".resultatestat").html(suggestion.estat);$(".nompartit").html(suggestion.partit);$(".totalpoblacio").html(suggestion.poblacio);$(".bototwitter").attr("href","https://twitter.com/intent/tweet?text=A "+suggestion.nom+"%20l%27%231O%20volem%20votar%20%23comsempre.%20"+suggestion.twitter+"%2C%20obri%20els%20col%C2%B7legis!%20https%3A%2F%2Fcomsempre.cat");$(".compart").attr("href","https://twitter.com/intent/tweet?text=A "+suggestion.nom+"%2C%20l%27%231O%20els%20col%C2%B7legis%20estaran%20oberts%20i%20votarem%20%23comsempre.%20I%20al%20teu%20municipi%3F%20Comprova-ho%20a%20https%3A%2F%2Fcomsempre.cat");if(suggestion.estat=='sí'){$(".bototwitter").hide();$(".compart").show();}else{$(".bototwitter").show();$(".compart").hide();}
$('#myModal').modal('show');});var $table=$('#fresh-table'),$alertBtn=$('#alertBtn'),full_screen=false;$().ready(function(){$('.carregant').hide();$('.fresh-table.full-color-azure').show();$table.bootstrapTable({toolbar:".toolbar",search:true,showfooter:true,showColumns:false,pagination:true,striped:true,pageSize:150,pageList:[100,200,500,1000],formatRecordsPerPage:function(pageNumber){return pageNumber+" files visibles";},icons:{refresh:'fa fa-refresh',toggle:'fa fa-th-list',columns:'fa fa-columns',detailOpen:'fa fa-plus-circle',detailClose:'fa fa-minus-circle'}});});(function($){'use strict';$.fn.bootstrapTable.locales['ca-ES']={formatLoadingMessage:function(){return'Espereu, si us plau...';},formatRecordsPerPage:function(pageNumber){return pageNumber+' resultats per pàgina';},formatShowingRows:function(pageFrom,pageTo,totalRows){return'Mostrant '+pageFrom+' de '+pageTo+' resultats. Total '+totalRows+' resultats';},formatSearch:function(){return'Busca per municipi o per partit';},formatNoMatches:function(){return'No s\'han trobat resultats';},formatPaginationSwitch:function(){return'Amaga/Mostra paginació';},formatRefresh:function(){return'Refresca';},formatToggle:function(){return'Alterna formatació';},formatColumns:function(){return'Columnes';},formatAllRows:function(){return'Tots';}};$.extend($.fn.bootstrapTable.defaults,$.fn.bootstrapTable.locales['ca-ES']);})(jQuery);$.getJSON("https://extramurs.carto.com/api/v2/sql?q=SELECT%20nom,estat,alcalde,comarca,poblacio,partit,twitter%20FROM%20municipis_catalunya",function(json){var hander2;hander2=json.rows;var countries3=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace('nom'),queryTokenizer:Bloodhound.tokenizers.whitespace,local:hander2});$('#prefetch .typeahead').typeahead({highlight:true},{name:'pobles',source:countries3,highlight:true,limit:7,display:'nom',templates:{empty:['<div class="empty-message">','<i class="fa fa-warning" style="color:#f90"></i> No s\'ha trobat cap població','</div>'].join('\n'),suggestion:Handlebars.compile('<div>{{nom}} <span style="font-size:13px">({{alcalde}}, <strong>{{partit}}</strong>)</span> <span class="badge {{estat}}"><i class="fa fa-envelope"></i> {{estat}}</span> <i class="fa fa-twitter" style="color:#1da1f2"></i><span class="noshow">{{cartodb_id}}</span></div>')}});});$(".btnmunicipis").on("click",function(){$("#mapamunicipis").show();$("#mapacomarques").hide();$("#mapademarcacions").hide();});$(".btncomarques").on("click",function(){$("#mapamunicipis").hide();$("#mapacomarques").show();$("#mapademarcacions").hide();});$(".btndemarcacions").on("click",function(){$("#mapamunicipis").hide();$("#mapacomarques").hide();$("#mapademarcacions").show();});var url='https://extramurs.carto.com/api/v2/sql?q=SELECT%20count(*)%20FROM%20municipis_catalunya%20WHERE%20estat%20=%20%27s%C3%AD%27';var url_wind='https://extramurs.carto.com/api/v2/sql?q=SELECT%20count(*)%20FROM%20municipis_catalunya%20WHERE%20estat%20=%20%27potser%27';$.when($.getJSON(url),$.getJSON(url_wind)).done(function(result1,result2){var municipissi=result1[0].rows[0].count;var municipispotser=result2[0].rows[0].count;var municipisno=948-municipissi-municipispotser;var percentsi=municipissi/948*100;var percentpotser=municipispotser/948*100;var percentno=municipisno/948*100;$(".textersi").html("Sí, votarà com sempre<br><span>("+municipissi+")</span>");$(".texterpotser").html("Potser<br><span>("+municipispotser+")</span>");$(".texterno").html("No<br><span>("+municipisno+")</span>");$(".progress-bar-info").css("width",percentsi+"%");$(".progress-bar-warning").css("width",percentpotser+"%");$(".progress-bar-danger").css("width",percentno+"%");});var partits=["PSC","CIU","PP","COMUNS","CUP","INDP","ERC"];var partits2=["PSC","CIU","PP","COMUNS","CUP","Independents","ERC"];partits.forEach(function llistar(value){window[value+"no"]="https://extramurs.carto.com/api/v2/sql?q=SELECT%20count(*)%20FROM%20municipis_catalunya%20WHERE%20partit%20=%20%27"+value+"%27%20AND%20estat%20=%20%27no%27";window[value+"potser"]="https://extramurs.carto.com/api/v2/sql?q=SELECT%20count(*)%20FROM%20municipis_catalunya%20WHERE%20partit%20=%20%27"+value+"%27%20AND%20estat%20=%20%27potser%27";window[value+"si"]="https://extramurs.carto.com/api/v2/sql?q=SELECT%20count(*)%20FROM%20municipis_catalunya%20WHERE%20partit%20=%20%27"+value+"%27%20AND%20estat%20=%20%27s%C3%AD%27";});$.when($.getJSON(ERCno),$.getJSON(ERCpotser),$.getJSON(PSCno),$.getJSON(PSCpotser),$.getJSON(CIUno),$.getJSON(CIUpotser),$.getJSON(COMUNSno),$.getJSON(COMUNSpotser),$.getJSON(PPno),$.getJSON(PPpotser),$.getJSON(CUPno),$.getJSON(CUPpotser),$.getJSON(INDPno),$.getJSON(INDPpotser),$.getJSON(ERCsi),$.getJSON(PSCsi),$.getJSON(CIUsi),$.getJSON(COMUNSsi),$.getJSON(PPsi),$.getJSON(CUPsi),$.getJSON(INDPsi)).done(function(result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12,result13,result14,result15,result16,result17,result18,result19,result20,result21){ERCno1=result1[0].rows[0].count;ERCpotser1=result2[0].rows[0].count;PSCno1=result3[0].rows[0].count;PSCpotser1=result4[0].rows[0].count;CIUno1=result5[0].rows[0].count;CIUpotser1=result6[0].rows[0].count;COMUNSno1=result7[0].rows[0].count;COMUNSpotser1=result8[0].rows[0].count;PPno1=result9[0].rows[0].count;PPpotser1=result10[0].rows[0].count;CUPno1=result11[0].rows[0].count;CUPpotser1=result12[0].rows[0].count;INDPno1=result13[0].rows[0].count;INDPpotser1=result14[0].rows[0].count;ERCsi1=result15[0].rows[0].count;PSCsi1=result16[0].rows[0].count;CIUsi1=result17[0].rows[0].count;COMUNSsi1=result18[0].rows[0].count;PPsi1=result19[0].rows[0].count;CUPsi1=result20[0].rows[0].count;INDPsi1=result21[0].rows[0].count;ERCtotal=ERCno1+ERCpotser1+ERCsi1;PSCtotal=PSCno1+PSCpotser1+PSCsi1;CIUtotal=CIUno1+CIUpotser1+CIUsi1;COMUNStotal=COMUNSno1+COMUNSpotser1+COMUNSsi1;PPtotal=PPno1+PPpotser1+PPsi1;CUPtotal=CUPno1+CUPpotser1+CUPsi1;INDPtotal=INDPno1+INDPpotser1+INDPsi1;ERCnop=Math.round(ERCno1/ERCtotal*10000000)/100000;ERCpotserp=Math.round(ERCpotser1/ERCtotal*10000000)/100000;PSCnop=Math.round(PSCno1/PSCtotal*10000000)/100000;PSCpotserp=Math.round(PSCpotser1/PSCtotal*10000000)/100000;CIUnop=Math.round(CIUno1/CIUtotal*10000000)/100000;CIUpotserp=Math.round(CIUpotser1/CIUtotal*10000000)/100000;COMUNSnop=Math.round(COMUNSno1/COMUNStotal*10000000)/100000;COMUNSpotserp=Math.round(COMUNSpotser1/COMUNStotal*10000000)/100000;PPnop=Math.round(PPno1/PPtotal*10000000)/100000;PPpotserp=Math.round(PPpotser1/PPtotal*10000000)/100000;CUPnop=Math.round(CUPno1/CUPtotal*10000000)/100000;CUPpotserp=Math.round(CUPpotser1/CUPtotal*10000000)/100000;INDPnop=Math.round(INDPno1/INDPtotal*10000000)/100000;INDPpotserp=Math.round(INDPpotser1/INDPtotal*10000000)/100000;ERCsip=Math.round(ERCsi1/ERCtotal*10000000)/100000;PSCsip=Math.round(PSCsi1/PSCtotal*10000000)/100000;CIUsip=Math.round(CIUsi1/CIUtotal*10000000)/100000;COMUNSsip=Math.round(COMUNSsi1/COMUNStotal*10000000)/100000;PPsip=Math.round(PPsi1/PPtotal*10000000)/100000;CUPsip=Math.round(CUPsi1/CUPtotal*10000000)/100000;INDPsip=Math.round(INDPsi1/INDPtotal*10000000)/100000;var colors1='#c6393d';var data1=[PSCno1,CIUno1,PPno1,COMUNSno1,CUPno1,INDPno1,ERCno1];var colors2='#ffcc00';var data2=[PSCpotser1,CIUpotser1,PPpotser1,COMUNSpotser1,CUPpotser1,INDPpotser1,ERCpotser1];var colors3='#4aa6d2';var data3=[PSCsi1,CIUsi1,PPsi1,COMUNSsi1,CUPsi1,INDPsi1,ERCsi1];var data1p=[PSCnop,CIUnop,PPnop,COMUNSnop,CUPnop,INDPnop,ERCnop];var data2p=[PSCpotserp,CIUpotserp,PPpotserp,COMUNSpotserp,CUPpotserp,INDPpotserp,ERCpotserp];var data3p=[PSCsip,CIUsip,PPsip,COMUNSsip,CUPsip,INDPsip,ERCsip];var barChartData={labels:partits2,datasets:[{label:'Municipis No',backgroundColor:colors1,data:data1},{label:'Municipis Indefinits',backgroundColor:colors2,data:data2},{label:'Municipis Si',backgroundColor:colors3,data:data3}]};var barChartData2={labels:partits2,datasets:[{label:'Municipis No',backgroundColor:colors1,data:data1p},{label:'Municipis Indefinits',backgroundColor:colors2,data:data2p},{label:'Municipis Si',backgroundColor:colors3,data:data3p}]};var ctx=document.getElementById("myChart");var myChart=new Chart(ctx,{type:'bar',data:barChartData,options:{legend:{display:false},title:{display:true,text:"Nombre de municipis del 'No' i els 'Indefinits'"},tooltips:{mode:'index',intersect:false},responsive:true,scales:{xAxes:[{stacked:true,}],yAxes:[{stacked:true,}]}}});var ctxa=document.getElementById("myCharta");var myCharta=new Chart(ctxa,{type:'bar',data:barChartData2,options:{legend:{display:false},title:{display:true,text:"% de municipis del 'No' i els 'Indefinits'"},tooltips:{mode:'index',intersect:false},responsive:true,scales:{xAxes:[{stacked:true,}],yAxes:[{stacked:true,ticks:{beginAtZero:true,steps:10,stepValue:5,max:100}}]}}});});var horizontalBarChartData={labels:["Alt Camp","Alt Empordà","Alt Penedès","Alt Urgell","Alta Ribagorça","Anoia","Bages","Baix Camp","Baix Ebre","Baix Empordà","Baix Llobregat","Baix Penedès","Barcelonès","Berguedà","Cerdanya","Conca de Barberà","Garraf","Garrigues","Garrotxa","Gironès","Maresme","Moianès","Montsià","Noguera","Osona","Pallars Jussà","Pallars Sobirà","Pla d'Urgell","Pla de l'Estany","Priorat","Ribera d'Ebre","Ripollès","Segarra","Segrià","Selva","Solsonès","Tarragonès","Terra Alta","Urgell","Val d'Aran","Vallès Occidental","Vallès Oriental"],datasets:[{label:'% Municipis',borderWidth:1,backgroundColor:'rgba(28, 215, 110, 0.47)',data:["86.96","98.53","51.85","100.00","100.00","96.97","96.67","92.86","78.57","100.00","56.67","64.29","0.00","100.00","94.12","100.00","66.67","100.00","95.24","96.43","80.00","90.00","83.33","100.00","100.00","100.00","100.00","100.00","100.00","95.65","100.00","94.74","100.00","92.11","92.31","100.00","54.55","83.33","100.00","88.89","69.57","76.92"]},{label:'% Habitants',backgroundColor:'rgba(243, 66, 141, 0.72)',data:["94.18","99.82","69.54","100","100","97.54","98.12","90.46","97.35","100","31.83","28.95","0","100","99.44","100","77.23","100","99.75","98.14","60.18","81.92","98.19","100","100","100","100","100","100","97.46","100","99.29","100","33.11","73.35","100","15.74","74.60","100","45.11","56.39","50.01"]}]};var ctx3=document.getElementById("myChart3");var myChart3=new Chart(ctx3,{type:'horizontalBar',data:horizontalBarChartData,options:{elements:{rectangle:{borderWidth:1,}},responsive:true,legend:{position:'right',},title:{display:true,text:'Comarques'},legend:{display:false}}});piedata={datasets:[{data:[3386689,1766436,2357983],backgroundColor:["#4aa6d2","#c6393d","#ffcc00"]}],labels:['Sí (45,09%)','No (23,52%)','Indefinit (31,39%)']};var ctx4=document.getElementById("myChart4");var myChart4=new Chart(ctx4,{type:'doughnut',data:piedata,options:{responsive:true,legend:{position:'right',},title:{display:true,text:'Població'},legend:{display:false}}});piedata={datasets:[{data:[849,86,13],backgroundColor:["#4aa6d2","#c6393d","#ffcc00"]}],labels:['Sí (89,56%)','No (9,07%)','Indefinit (1,37%)']};var ctx5=document.getElementById("myChart5");var myChart5=new Chart(ctx5,{type:'doughnut',data:piedata,options:{responsive:true,legend:{position:'right',},title:{display:true,text:'Municipis'},legend:{display:false}}});var bardata1={labels:["Barcelona","Girona","Lleida","Tarragona"],datasets:[{label:'% Població',borderWidth:0,backgroundColor:'rgba(28, 215, 110, 0.47)',data:[34.49,93.52,66.38,61.14]},{label:'% Municipis',backgroundColor:'rgba(243, 66, 141, 0.72)',data:[81.21,96.90,98.21,84.24]}]};var ctx7=document.getElementById("myChart7");var myChart7=new Chart(ctx7,{type:'bar',data:bardata1,options:{responsive:true,legend:{position:'right',},title:{display:true,text:'Demarcacions'},legend:{display:false},scales:{yAxes:[{ticks:{beginAtZero:true}}]}}});piedata8={datasets:[{data:[10,20,30]}],labels:['Red','Yellow','Blue']};var ctx8=document.getElementById("myChart8");var myChart8=new Chart(ctx8,{type:'doughnut',data:piedata8,options:{responsive:true,legend:{position:'right',},title:{display:true,text:'Municipis'},legend:{display:false}}});